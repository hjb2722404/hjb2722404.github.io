<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>UEditor源码分析—— 浏览器检测技术分析 | 林中路</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="

为了保证编辑器在各个不同浏览器上的一致性，Ueditor实现了一套完整而详细的浏览器内核和版本检测类，并且也将它挂载在了UE对象上，作为工具开放给开发者使用。

var browser = UE.browser = function() {
        // ...
    }();

我们来看一下浏览器内核、平台与模式检测的实现原理。

* ...">
    
    <link rel="preload" href="/assets/css/0.styles.6d0d6f13.css" as="style"><link rel="preload" href="/assets/js/app.cd8205c8.js" as="script"><link rel="preload" href="/assets/js/11.4c288b74.js" as="script"><link rel="preload" href="/assets/js/119.93634bcc.js" as="script"><link rel="prefetch" href="/assets/js/1.c492b4cd.js"><link rel="prefetch" href="/assets/js/10.5c791580.js"><link rel="prefetch" href="/assets/js/100.98ff7760.js"><link rel="prefetch" href="/assets/js/101.e5cd16d7.js"><link rel="prefetch" href="/assets/js/102.cc9bc85b.js"><link rel="prefetch" href="/assets/js/103.7b07b598.js"><link rel="prefetch" href="/assets/js/104.ee58d457.js"><link rel="prefetch" href="/assets/js/105.48c57f25.js"><link rel="prefetch" href="/assets/js/106.b702757c.js"><link rel="prefetch" href="/assets/js/107.8122f1ef.js"><link rel="prefetch" href="/assets/js/108.51e66dbe.js"><link rel="prefetch" href="/assets/js/109.3145253b.js"><link rel="prefetch" href="/assets/js/110.f9990065.js"><link rel="prefetch" href="/assets/js/111.3263bd3f.js"><link rel="prefetch" href="/assets/js/112.9071b5e2.js"><link rel="prefetch" href="/assets/js/113.f131242e.js"><link rel="prefetch" href="/assets/js/114.7a6e09f7.js"><link rel="prefetch" href="/assets/js/115.508d99ac.js"><link rel="prefetch" href="/assets/js/116.f4900a92.js"><link rel="prefetch" href="/assets/js/117.e5957144.js"><link rel="prefetch" href="/assets/js/118.062eb3c1.js"><link rel="prefetch" href="/assets/js/12.c3b16095.js"><link rel="prefetch" href="/assets/js/120.1bada0ab.js"><link rel="prefetch" href="/assets/js/121.7d55e294.js"><link rel="prefetch" href="/assets/js/122.b7f7c837.js"><link rel="prefetch" href="/assets/js/123.3a0b4694.js"><link rel="prefetch" href="/assets/js/124.bd458b77.js"><link rel="prefetch" href="/assets/js/125.8ca612c9.js"><link rel="prefetch" href="/assets/js/126.35bccb3e.js"><link rel="prefetch" href="/assets/js/127.9b3097f5.js"><link rel="prefetch" href="/assets/js/128.5833cf40.js"><link rel="prefetch" href="/assets/js/129.38ec9907.js"><link rel="prefetch" href="/assets/js/13.91404f5a.js"><link rel="prefetch" href="/assets/js/130.932a54c4.js"><link rel="prefetch" href="/assets/js/131.f4ab894a.js"><link rel="prefetch" href="/assets/js/14.ef93462f.js"><link rel="prefetch" href="/assets/js/15.83829c35.js"><link rel="prefetch" href="/assets/js/16.d245c760.js"><link rel="prefetch" href="/assets/js/17.4a9f3c99.js"><link rel="prefetch" href="/assets/js/18.75ce45c7.js"><link rel="prefetch" href="/assets/js/19.b86d35ae.js"><link rel="prefetch" href="/assets/js/20.9657eb2e.js"><link rel="prefetch" href="/assets/js/21.f89cf353.js"><link rel="prefetch" href="/assets/js/22.746aec5f.js"><link rel="prefetch" href="/assets/js/23.ca2ee980.js"><link rel="prefetch" href="/assets/js/24.e1eeb0f4.js"><link rel="prefetch" href="/assets/js/25.f96e0147.js"><link rel="prefetch" href="/assets/js/26.cc4cf83e.js"><link rel="prefetch" href="/assets/js/27.f940e542.js"><link rel="prefetch" href="/assets/js/28.99771a3c.js"><link rel="prefetch" href="/assets/js/29.841b64b0.js"><link rel="prefetch" href="/assets/js/30.772e1ff4.js"><link rel="prefetch" href="/assets/js/31.7e0b62c5.js"><link rel="prefetch" href="/assets/js/32.cf3d5fb6.js"><link rel="prefetch" href="/assets/js/33.b338e29a.js"><link rel="prefetch" href="/assets/js/34.8b8356fe.js"><link rel="prefetch" href="/assets/js/35.1b12a1f7.js"><link rel="prefetch" href="/assets/js/36.547e2f8d.js"><link rel="prefetch" href="/assets/js/37.36a240bd.js"><link rel="prefetch" href="/assets/js/38.4f6b92e3.js"><link rel="prefetch" href="/assets/js/39.5133d0dd.js"><link rel="prefetch" href="/assets/js/4.524efd0b.js"><link rel="prefetch" href="/assets/js/40.8c765af6.js"><link rel="prefetch" href="/assets/js/41.b7234e21.js"><link rel="prefetch" href="/assets/js/42.b5ac212a.js"><link rel="prefetch" href="/assets/js/43.5d1b3b6c.js"><link rel="prefetch" href="/assets/js/44.eda633f8.js"><link rel="prefetch" href="/assets/js/45.39f5263b.js"><link rel="prefetch" href="/assets/js/46.f1fbfada.js"><link rel="prefetch" href="/assets/js/47.ed969447.js"><link rel="prefetch" href="/assets/js/48.e1867366.js"><link rel="prefetch" href="/assets/js/49.c2a4bc6b.js"><link rel="prefetch" href="/assets/js/5.a180cf14.js"><link rel="prefetch" href="/assets/js/50.da77d6a3.js"><link rel="prefetch" href="/assets/js/51.4183e6ab.js"><link rel="prefetch" href="/assets/js/52.b18add11.js"><link rel="prefetch" href="/assets/js/53.08c1d448.js"><link rel="prefetch" href="/assets/js/54.9edeb19b.js"><link rel="prefetch" href="/assets/js/55.9a3ed63e.js"><link rel="prefetch" href="/assets/js/56.dcf34dca.js"><link rel="prefetch" href="/assets/js/57.2123aa49.js"><link rel="prefetch" href="/assets/js/58.c9833b3b.js"><link rel="prefetch" href="/assets/js/59.8da7c174.js"><link rel="prefetch" href="/assets/js/6.529edc8a.js"><link rel="prefetch" href="/assets/js/60.9a70415e.js"><link rel="prefetch" href="/assets/js/61.35935df8.js"><link rel="prefetch" href="/assets/js/62.0e63cfe7.js"><link rel="prefetch" href="/assets/js/63.a52d5a72.js"><link rel="prefetch" href="/assets/js/64.cf7dfcc7.js"><link rel="prefetch" href="/assets/js/65.0220a5ee.js"><link rel="prefetch" href="/assets/js/66.5cd774f3.js"><link rel="prefetch" href="/assets/js/67.d8943555.js"><link rel="prefetch" href="/assets/js/68.7cf24f78.js"><link rel="prefetch" href="/assets/js/69.56501738.js"><link rel="prefetch" href="/assets/js/7.ac95b826.js"><link rel="prefetch" href="/assets/js/70.9626260f.js"><link rel="prefetch" href="/assets/js/71.a466c6f1.js"><link rel="prefetch" href="/assets/js/72.0a678f77.js"><link rel="prefetch" href="/assets/js/73.597ea695.js"><link rel="prefetch" href="/assets/js/74.a0387d5c.js"><link rel="prefetch" href="/assets/js/75.97871f2e.js"><link rel="prefetch" href="/assets/js/76.7d8e44c7.js"><link rel="prefetch" href="/assets/js/77.b53c8e31.js"><link rel="prefetch" href="/assets/js/78.9fef1461.js"><link rel="prefetch" href="/assets/js/79.9af76496.js"><link rel="prefetch" href="/assets/js/8.6bb76bea.js"><link rel="prefetch" href="/assets/js/80.5f7ee3db.js"><link rel="prefetch" href="/assets/js/81.1937e784.js"><link rel="prefetch" href="/assets/js/82.2bdeb675.js"><link rel="prefetch" href="/assets/js/83.e04a8620.js"><link rel="prefetch" href="/assets/js/84.ca8713d0.js"><link rel="prefetch" href="/assets/js/85.40f655ff.js"><link rel="prefetch" href="/assets/js/86.87397155.js"><link rel="prefetch" href="/assets/js/87.798cdf26.js"><link rel="prefetch" href="/assets/js/88.e089f692.js"><link rel="prefetch" href="/assets/js/89.5d842e18.js"><link rel="prefetch" href="/assets/js/9.5b2ac283.js"><link rel="prefetch" href="/assets/js/90.4157be98.js"><link rel="prefetch" href="/assets/js/91.7ed6afe7.js"><link rel="prefetch" href="/assets/js/92.9c50ce3b.js"><link rel="prefetch" href="/assets/js/93.e8e16a70.js"><link rel="prefetch" href="/assets/js/94.cf98a377.js"><link rel="prefetch" href="/assets/js/95.a4b78938.js"><link rel="prefetch" href="/assets/js/96.a7a9f018.js"><link rel="prefetch" href="/assets/js/97.f96c42c9.js"><link rel="prefetch" href="/assets/js/98.ce7378e5.js"><link rel="prefetch" href="/assets/js/99.24959418.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.706cf0ce.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6d0d6f13.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout"><div class="header"><div class="blog-info" data-v-54e0dde5>
   林中路
   <p data-v-54e0dde5>少有人走的路，逐渐向世界显现</p></div> <div class="blog-author-info" data-v-51bc2051><p class="author-head-img" data-v-51bc2051><img src="/assets/img/head-img.8e2d0100.png" alt data-v-51bc2051></p></div> <div class="blog-category-list" data-v-581efa6b><ul data-v-581efa6b></ul></div></div> <div class="content"><div class="template-container" data-v-b70586ba><div class="content" data-v-b70586ba><div class="content__default" data-v-b70586ba><h1 id="ueditor源码分析-浏览器检测技术分析"><a href="#ueditor源码分析-浏览器检测技术分析" class="header-anchor">#</a> UEditor源码分析—— 浏览器检测技术分析</h1> <p>为了保证编辑器在各个不同浏览器上的一致性，<code>Ueditor</code>实现了一套完整而详细的浏览器内核和版本检测类，并且也将它挂载在了<code>UE</code>对象上，作为工具开放给开发者使用。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> browser <span class="token operator">=</span> <span class="token constant">UE</span><span class="token punctuation">.</span><span class="token function-variable function">browser</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>我们来看一下浏览器内核、平台与模式检测的实现原理。</p> <ul><li><p>对于<code>opera</code>浏览器，直接检查挂载在window上的<code>opera</code>对象</p></li> <li><p>IE内核浏览器： 检查<code>navigator.userAgent</code>字符串中是否包含<code>msie</code>或者 <code>trident.*rv</code> 子串</p></li> <li><p><code>webkit</code>内核浏览器： 检查<code>navigator.userAgent</code>字符串中是否包含<code>applewebkit</code> 子串。</p></li> <li><p>是否运行在mac上： 检查<code>navigator.userAgent</code> 字符串中是否包含<code>macintosh</code> 子串（如果同时包含<code>applewebkit</code>和<code>macintosh</code>子串，则说明是运行在mac OS上的<code>webkit</code>内核浏览器）</p></li> <li><p>浏览器是是否运行在怪异模式下： 检查 <code>document.compatMode</code> 属性，如果值为<code>BackCompat</code>则为怪异模式，如果值为<code>CSS1Compat</code> ,则为标准模式。</p></li> <li><p><code>gecko</code> 内核浏览器： <code>navigator.product</code> 为<code>Gecko</code> ，并且不是上面三种内核（opera/webkit/ie）</p></li></ul> <p>然后看下具体的版本检测原理：</p> <ul><li><p><code>IE</code>: 分三种情况</p> <ul><li><p>同时具有<code>msie</code>和<code>trident</code>标识，选取两个版本号中较大的一个</p></li> <li><p>只包含<code>msie</code>标识的，直接采用该标识后面跟的版本号</p></li> <li><p>只包含<code>trident</code>标识的，直接采用该标识后面跟的版本号</p> <p>如果都没有，则版本号为 0；</p></li></ul></li> <li><p><code>IE</code> 的兼容模式判断</p> <ul><li><code>IE9兼容模式</code> ： <code>document.documentMode</code> 值为 9;</li> <li><code>IE11兼容模式</code> ： <code>document.documentMode</code> 值为 11;</li> <li><code>IE8兼容模式</code> ： <code>document.documentMode</code> 值为 8;</li> <li><code>IE7兼容模式</code> ： <code>document.documentMode</code> 值为 7， 或者 <code>document.documentMode</code>的值未定义，但版本号为7;</li> <li><code>IE6兼容模式</code> ： 版本号小于 7 或者 浏览器处于怪异模式下</li></ul></li> <li><p><code>IE</code>其它版本：</p> <ul><li><code>IE9</code>及以上 ： 版本号大于8</li> <li><code>IE9</code>以下： 版本号小于 9</li> <li><code>IE11</code>及以上： 版本号大于10</li> <li><code>IE11</code> 以下： 版本号小于 11</li></ul></li> <li><p><code>Gecko</code> 版本号判断（主要用于<code>firefox</code>浏览器）</p> <ul><li>匹配<code>navigator.userAgent</code>中 <code>rv:</code>后面的数字</li> <li>使用<code>.</code>分割符分割匹配到的数字</li> <li>第一位乘以10000，第二位乘以100，第三位乘以1，相加后就是最终的版本号，例如匹配的数字为1.9，则版本号为：10900</li></ul></li> <li><p><code>chrome</code> 浏览器版本号：</p> <ul><li>检测当前浏览器是否为Chrome, 如果是，则返回Chrome的大版本号</li> <li>检测是否为<code>Chrome</code>: 检查<code>navigator</code>中是否包含<code>chrome</code>标识</li></ul></li> <li><p><code>safari</code>浏览器版本的检测</p> <ul><li><code>navigator.userAgent</code> 不包含<code>chrome</code>标识</li> <li><code>navigator.userAgent</code> 包含 <code>safari标识</code></li> <li>正则匹配<code>safari</code>标识前后的数字就是版本号</li></ul></li> <li><p>在以上两种浏览器的版本号匹配中，我们会看到程序中有以下代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">+</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">[</span><span class="token string">'\x241'</span><span class="token punctuation">]</span> <span class="token operator">||</span> RegExp<span class="token punctuation">[</span><span class="token string">'\x242'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这实际上代表了正则表达式中匹配到的分组，<code>\x241</code> 代表<code>$1</code>， <code>\x242</code> 代表 <code>$2</code>.</p></li> <li><p><code>opera</code> 浏览器版本号获取</p> <ul><li>直接使用 <code>window.opera.version()</code> 方法获取</li></ul></li> <li><p>最后，提供了一个属性来检测当前浏览器是否能与编辑器良好兼容：</p> <ul><li><code>UE.browser.isCompatible</code></li></ul></li></ul></div></div></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.cd8205c8.js" defer></script><script src="/assets/js/11.4c288b74.js" defer></script><script src="/assets/js/119.93634bcc.js" defer></script>
  </body>
</html>
